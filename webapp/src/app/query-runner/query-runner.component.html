<mat-tab-group [(selectedIndex)]="tabIndex">
  <mat-tab label="Explanations">
    <div class="tab-content">
      <p>
        SPINDLE enables the training of
        <a href="https://en.wikipedia.org/wiki/Generalized_linear_model"
          >generalized linear models</a
        >
        across federated datasets. This demo showcases the training of a
        <a href="https://en.wikipedia.org/wiki/Logistic_regression">
          logistic regression model </a
        >. The trained model can then be used to perform predictions on
        unlabelled data samples.
        <br />
        Each dataset is kept private by a dedicated node, and never shared with
        the other participants of the network. The trained model itself is not
        revealed to anyone but can be evaluated with an unlabelled data sample
        that only the querier knows.
        <br />
        In the next tab, you can choose the parameters of the model to be
        trained, and the unlabelled data sample to predict. The result will be
        shown in the last tab.
      </p>

      <ul>
        <li>
          <b>Learning rate</b>: how much each iteration is to be taken into
          account. The greater, the faster it will obtain a solution but the
          more likely the solution won't be the best one.
        </li>
        <li>
          <b>Elastic rate:</b> how much randomness to add at each local
          iteration, to try to find a better solution that the previous one.
        </li>
        <li>
          <b>Local iteration count</b>: how many times the local model is
          trained before doing a network iteration. The greater, the slower it
          will compute locally but, if the datasets are similar, it would
          require less network iterations.
        </li>
        <li>
          <b>Local batch size</b>: when computing a local iteration, how many
          labelled data samples to train upon at the same time. The greater, the
          more precise the solution will be but the more memory it will take.
        </li>
        <li>
          <b>Network iteration count</b>: how many times is the model on the
          whole network trained, that is computing an aggregatation of each
          local model, and used this to feed the next local iterations.
        </li>
      </ul>
    </div>
  </mat-tab>

  <mat-tab label="Train Model">
    <form
      [formGroup]="trainForm"
      (ngSubmit)="runTrainRequest()"
      class="tab-content"
    >
      <mat-list>
        <mat-list-item>
          <mat-form-field>
            <mat-label>Learning rate</mat-label>
            <input
              matInput
              type="number"
              min="0.01"
              max="1"
              step="0.01"
              formControlName="learningRate"
            />
          </mat-form-field>
        </mat-list-item>

        <mat-list-item>
          <mat-form-field>
            <mat-label>Elastic rate</mat-label>
            <input
              matInput
              type="number"
              min="0.01"
              max="1"
              step="0.01"
              formControlName="elasticRate"
            />
          </mat-form-field>
        </mat-list-item>

        <mat-list-item>
          <mat-form-field>
            <mat-label>Local iteration count</mat-label>
            <input
              matInput
              type="number"
              min="1"
              formControlName="localIterationCount"
            />
          </mat-form-field>
        </mat-list-item>

        <mat-list-item>
          <mat-form-field>
            <mat-label>Local batch size</mat-label>
            <input
              matInput
              type="number"
              min="1"
              formControlName="localBatchSize"
            />
          </mat-form-field>
        </mat-list-item>

        <mat-list-item>
          <mat-form-field>
            <mat-label>Network iteration count (epochs)</mat-label>
            <input
              matInput
              type="number"
              min="1"
              formControlName="networkIterationCount"
            />
          </mat-form-field>
        </mat-list-item>

        <mat-list-item>
          <button
            mat-raised-button
            color="primary"
            type="submit"
            [disabled]="!trainForm.valid"
          >
            Train
          </button>
        </mat-list-item>
      </mat-list>
    </form>
  </mat-tab>

  <mat-tab label="Predict with a Model">
    <div fxLayout="column" class="tab-content">
      <div *ngIf="state[0] === 'training'" class="result-line">
        Training model...
      </div>

      <div
        *ngIf="state[0] === 'training' || state[0] === 'train error'"
        class="result-line"
      >
        <ng-container *ngIf="state[0] === 'training'">
          <ng-container *ngIf="state[1] === undefined">
            <div fxLayout>
              Connecting
              <mat-progress-bar mode="buffer"></mat-progress-bar>
            </div>
          </ng-container>
          <ng-container *ngIf="state[1] !== undefined">
            <div fxLayout>
              Local
              <mat-progress-bar
                mode="determinate"
                value="{{ state[1][0] }}"
              ></mat-progress-bar>
            </div>
            <div fxLayout>
              Network
              <mat-progress-bar
                mode="determinate"
                value="{{ state[1][1] }}"
              ></mat-progress-bar>
            </div>
          </ng-container>
        </ng-container>
        <ng-container *ngIf="state[0] === 'train error'">
          Error encountered when training model: {{ state[1].message }}
        </ng-container>
      </div>

      <div
        *ngIf="
          state[0] === 'trained' ||
          state[0] === 'predict error' ||
          state[0] === 'predicted'
        "
      >
        <div class="result-line">Model ID: {{ state[1] }}</div>

        <div class="result-line">
          <form
            [formGroup]="predictForm"
            (ngSubmit)="runPredictRequest()"
            class="result-line"
          >
            <mat-form-field>
              <mat-label>To predict</mat-label>
              <input matInput type="text" formControlName="toPredict" />
            </mat-form-field>

            <button
              mat-raised-button
              color="primary"
              type="submit"
              [disabled]="!predictForm.valid"
            >
              Predict
            </button>
          </form>
        </div>
      </div>

      <div class="result-line">
        <ng-container *ngIf="state[0] === 'predicted'">
          The trained model predicts that the given unlabelled data sample's
          label will be: <b>{{ state[2] }}</b>
        </ng-container>
        <ng-container *ngIf="state[0] === 'predict error'">
          Error encountered when training model: {{ state[2].message }}
        </ng-container>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>
